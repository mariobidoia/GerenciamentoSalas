<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agendamento de Ambientes</title>

    <!-- Folha de Estilo Externa -->
    <link rel="stylesheet" href="style.css" />

    <style>
      @view-transition {
        navigation: auto;
      }
    </style>

    <!-- Tailwind CSS (mantido do original) -->
    <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
  </head>
  <body class="light-theme">
    <!-- Login Screen -->
    <div class="login-screen" id="login-screen">
      <div class="login-container">
        <div class="login-header">
          <h1 id="login-title">Agendamento de Ambientes</h1>
          <p id="login-subtitle">Sistema de Reserva de Espa√ßos</p>
        </div>
        <form class="login-form" id="login-form">
          <div class="form-group">
            <label for="login-nif">NIF (Usu√°rio)</label>
            <input
              type="text"
              id="login-nif"
              required
              placeholder="Digite seu NIF"
            />
          </div>
          <div class="form-group">
            <label for="login-senha">Senha</label>
            <input
              type="password"
              id="login-senha"
              required
              placeholder="Digite sua senha"
            />
          </div>
          <div class="form-error" id="login-error" style="display: none"></div>
          <button type="submit" class="btn-primary" id="login-btn">
            Entrar
          </button>
        </form>
      </div>
    </div>

    <!-- Change Password Modal (Coordenador) -->
    <div class="modal" id="change-password-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Alterar Senha</h2>
          <button class="close-btn" data-close="change-password-modal">
            √ó
          </button>
        </div>
        <form id="change-password-form">
          <div class="form-group">
            <label for="cp-current-password">Senha Atual</label>
            <input type="password" id="cp-current-password" required />
          </div>
          <div class="form-group">
            <label for="cp-new-password">Nova Senha</label>
            <input type="password" id="cp-new-password" required />
          </div>
          <div class="form-group">
            <label for="cp-confirm-password">Confirmar Nova Senha</label>
            <input type="password" id="cp-confirm-password" required />
          </div>
          <div class="form-error" id="cp-error" style="display: none"></div>
          <button type="submit" class="btn-primary" id="cp-submit-btn">
            Alterar Senha
          </button>
        </form>
      </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container" id="app-container" style="display: none">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="header w-full">
          <div class="header-content px-4 py-3">
            <div class="flex w-full">
              <h1 id="app-title">Agendamento</h1>
             <button class="theme-toggle ml-3" id="theme-toggle">
            <span id="theme-icon">üåô</span>
            
          </button></div>
            <p id="app-subtitle">Reserva de Espa√ßos</p>
            <div class="user-info">
              <span class="user-name" id="user-name">üë§ Usu√°rio</span>
              <button class="logout-btn" id="logout-btn">Sair</button>
              
            </div>
           
          </div>
          
        </div>

        <!-- Navigation -->
        <div class="nav-section">
          <div class="nav-buttons">
            <button class="nav-btn active" data-view="calendar">
              <span class="nav-icon">üìÖ</span> <span>Calend√°rio</span>
            </button>
            <button class="nav-btn" data-view="categories">
              <span class="nav-icon">üìã</span> <span>Ambientes</span>
            </button>
            <button class="nav-btn prof-only" data-view="requests">
              <span class="nav-icon">üîî</span> <span>Minhas Solicita√ß√µes</span>
            </button>
            <button class="nav-btn" data-view="my-schedules">
              <span class="nav-icon">‚úÖ</span> <span>Meus Agendamentos</span>
            </button>
            <button class="nav-btn coord-only" data-view="all-requests">
              <span class="nav-icon">üîî</span> <span>Todas Solicita√ß√µes</span>
            </button>
            <!-- Adicionar link para Admin de Ambientes/Categorias se for Coordenador -->
          </div>
        </div>

        <!-- Filters / Actions -->
        <div class="filter-section">
          <!-- <button class="new-reservation-btn" id="new-reservation-btn">
            <span>‚ûï</span> <span>Nova Solicita√ß√£o</span>
          </button> -->
           <div class="ambiente-filter hidden">
            <span>üè¢</span>
            <select id="ambiente-filter">
              <option value="">Todos os Ambientes</option>
            </select>
          </div> 
        </div>

        <!-- Categories List (Sidebar) -->
        <div class="categories-section">
          <h2 class="section-title">Categorias</h2>
          <div id="categories-sidebar">
            <div class="loading-spinner"></div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Calendar View -->
        <div class="view active" id="calendar-view">
          <div class="calendar-container">
            <div class="calendar-header">
              <h2 class="calendar-title" id="calendar-title">Janeiro 2024</h2>
              <div class="calendar-nav">
                <button class="calendar-nav-btn" id="prev-month">
                  ‚Äπ Anterior
                </button>
                <button class="calendar-nav-btn" id="today-btn">Hoje</button>
                <button class="calendar-nav-btn" id="next-month">
                  Pr√≥ximo ‚Ä∫
                </button>
              </div>
            </div>
            <div class="calendar-grid" id="calendar-grid">
              <!-- Dias do calend√°rio ser√£o gerados aqui -->
            </div>
            <div class="day-summary" id="day-summary">
              <div class="summary-header">
                <h3 class="summary-title" id="summary-title">
                  Selecione uma data
                </h3>
                <button
                  class="btn-primary"
                  id="summary-new-request-btn"
                  style="display: none"
                >
                  <span class="nav-icon">‚ûï</span> Nova Solicita√ß√£o
                </button>
              </div>
              <div id="summary-content">
                <div class="summary-empty">
                  Clique em uma data para ver os agendamentos
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Categories View (Main Panel) -->
        <div class="view" id="categories-view">
          <div class="categories-grid" id="categories-grid">
            <div class="loading-spinner"></div>
          </div>
        </div>

        <!-- My Requests View -->
        <div class="view" id="requests-view">
          <div class="overview-panel">
            <div class="overview-header">
              <h2>Minhas Solicita√ß√µes Pendentes</h2>
            </div>
            <div id="my-requests-list" class="requests-list-container">
              <div class="loading-spinner"></div>
            </div>
          </div>
        </div>

        <!-- My Schedules View -->
        <div class="view" id="my-schedules-view">
          <div class="overview-panel">
            <div class="overview-header">
              <h2>Meus Pr√≥ximos Agendamentos</h2>
            </div>
            <div id="my-schedules-list" class="schedules-list-container">
              <div class="loading-spinner"></div>
            </div>
          </div>
          <div class="overview-panel">
            <div class="overview-header">
              <h2>Meus Agendamentos Recorrentes</h2>
            </div>
            <div
              id="my-recurring-schedules-list"
              class="schedules-list-container"
            >
              <div class="loading-spinner"></div>
            </div>
          </div>
        </div>
        
        <!-- All Requests View (Coordinator) -->
        <div class="view coord-only" id="all-requests-view">
          <div class="overview-panel">
            <div class="overview-header">
              <h2>Todas Solicita√ß√µes Pendentes</h2>
            </div>
            <div id="all-requests-list" class="requests-list-container">
              <div class="loading-spinner"></div>
            </div>
          </div>
        </div>
      </div>
      </div>
      <!-- Fim main-content -->
    </div>
    <!-- Fim app-container -->

    <!-- Modal de Solicita√ß√£o -->
    <div class="modal" id="reservation-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title" id="modal-title">Nova Solicita√ß√£o</h2>
          <button class="close-btn" data-close="reservation-modal">√ó</button>
        </div>
        <form id="reservation-form">
          <!-- Campo oculto para ID (usado na edi√ß√£o) -->
          <input type="hidden" id="request-id" />

          <!-- Categoria e Ambiente -->
          <div class="form-group" id="categoria-form-group">
            <label for="categoria">Categoria</label>
            <select id="categoria">
              <option value="">Selecione a categoria</option>
            </select>
          </div>

          <div class="form-group">
            <label for="ambiente">Ambiente</label>
            <select id="ambiente" required>
                <option value="">Selecione o ambiente</option>
            </select>
          </div>
          <!-- Turma e Justificativa -->
          <div class="form-group">
            <label for="turma">Turma</label>
            <input type="text" id="turma" required placeholder="Ex: 3¬∫ Ano A" />
          </div>
          <div class="form-group">
            <label for="justification">Justificativa (Opcional)</label>
            <textarea
              id="justification"
              rows="2"
              placeholder="Motivo da reserva (se necess√°rio)"
            ></textarea>
          </div>

          <!-- Tipo de Reserva (√önica ou Recorrente) -->
          <div class="form-group">
            <label>Tipo de Reserva</label>
            <div class="tabs">
              <button type="button" class="tab-btn active" data-tab="unica">
                Data √önica
              </button>
              <button type="button" class="tab-btn" data-tab="recorrente">
                Recorrente
              </button>
            </div>
          </div>

          <!-- Op√ß√µes de Data √önica -->
          <div class="tab-content active" id="tab-unica">
            <div class="form-group">
              <label for="data">Data</label>
              <input type="date" id="data" />
            </div>
          </div>

          <!-- Op√ß√µes de Recorr√™ncia -->
          <div class="tab-content" id="tab-recorrente">
            <div class="form-group">
              <label for="recorrencia-tipo">Tipo de Recorr√™ncia</label>
              <select id="recorrencia-tipo">
                <option value="daily">Diariamente</option>
                <option value="weekly">Semanalmente</option>
              </select>
            </div>
            <div
              class="form-group"
              id="dias-semana-group"
              style="display: none"
            >
              <label>Dias da Semana</label>
              <div class="days-selector">
                <label class="day-checkbox">
                  <input type="checkbox" value="0" name="dayOfWeek" />
                  <span>Dom</span>
                </label>
                <label class="day-checkbox">
                  <input type="checkbox" value="1" name="dayOfWeek" />
                  <span>Seg</span>
                </label>
                <label class="day-checkbox">
                  <input type="checkbox" value="2" name="dayOfWeek" />
                  <span>Ter</span>
                </label>
                <label class="day-checkbox">
                  <input type="checkbox" value="3" name="dayOfWeek" />
                  <span>Qua</span>
                </label>
                <label class="day-checkbox">
                  <input type="checkbox" value="4" name="dayOfWeek" />
                  <span>Qui</span>
                </label>
                <label class="day-checkbox">
                  <input type="checkbox" value="5" name="dayOfWeek" />
                  <span>Sex</span>
                </label>
                <label class="day-checkbox">
                  <input type="checkbox" value="6" name="dayOfWeek" />
                  <span>S√°b</span>
                </label>
              </div>
            </div>
            <div class="form-group" id="weekdays-only-group">
              <label
                class="day-checkbox"
                style="flex-direction: row; align-items: center; gap: 8px"
              >
                <input type="checkbox" id="weekdays-only" />
                <span>Apenas dias de semana (Seg-Sex)</span>
              </label>
            </div>
            <div class="form-group">
              <label for="recorrencia-inicio">Data de In√≠cio</label>
              <input type="date" id="recorrencia-inicio" />
            </div>
            <div class="form-group">
              <label for="recorrencia-fim">Data de Fim</label>
              <input type="date" id="recorrencia-fim" />
            </div>
          </div>

          <div class="flex gap-4">
            <div class="form-group flex-1">
              <label for="hora-inicio">Hora In√≠cio</label>
              <input type="time" id="hora-inicio" required class="w-full p-2 border rounded">
            </div>
            <div class="form-group flex-1">
              <label for="hora-fim">Hora Fim</label>
              <input type="time" id="hora-fim" required class="w-full p-2 border rounded">
            </div>
          </div>

          <!-- Pr√©via de Conflito -->
          <div
            class="recurrence-preview"
            id="conflict-preview"
            style="display: none"
          >
            <div class="conflict-content" id="conflict-content">
              <!-- Conte√∫do do conflito ser√° inserido aqui -->
            </div>
          </div>

          <!-- Bot√£o de Envio -->
          <button type="submit" class="btn-primary" id="submit-btn">
            <span id="submit-btn-text">Enviar Solicita√ß√£o</span>
            <span
              class="loading"
              id="submit-btn-loading"
              style="display: none"
            ></span>
          </button>
        </form>
      </div>
    </div>

    <!-- Modal de Confirma√ß√£o (Gen√©rico) -->
    <div class="modal" id="confirm-modal">
      <div class="modal-content" style="max-width: 400px">
        <div class="modal-header">
          <h2 class="modal-title" id="confirm-title">Confirmar A√ß√£o</h2>
        </div>
        <p
          id="confirm-message"
          style="
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
          "
        >
          Voc√™ tem certeza?
        </p>
        <div class="form-group" id="confirm-options" style="display: none">
          <!-- Op√ß√µes extras (ex: for√ßar/pular) -->
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="confirm-btn-cancel">
            Cancelar
          </button>
          <button type="button" class="btn-primary" id="confirm-btn-ok">
            Confirmar
          </button>
        </div>
      </div>
    </div>

    <!-- NOVO: Modal de Erro de Conflito -->
    <div
      id="conflict-error-modal"
      class="modal fixed inset-0 bg-black bg-opacity-70 justify-center items-center p-4 z-[60]"
    >
      <div
        class="bg-gray-800 p-6 rounded-lg shadow-xl w-full max-w-md animate-fade-in border border-yellow-500"
      >
        <div class="flex justify-between items-center m-4">
          <svg
            class="h-6 w-6 text-yellow-400 mr-3"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
            />
          </svg>
          <h2 class="text-xl font-bold text-yellow-400 w-full">
            Conflito Detectado
          </h2>
          <button
            id="close-conflict-modal-btn"
            class="hover:text-yellow-400 text-white font-bold transition-colors text-sm"
          >
            X
          </button>
        </div>
        <p id="conflict-error-message" class="text-gray-300 mb-6 text-base">
          Mensagem de conflito aqui...
        </p>
        <div class="flex flex-col sm:flex-row justify-end gap-3">
          <button
            id="conflict-deny-btn"
            class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition-colors text-sm order-3 sm:order-1"
          >
            Negar Solicita√ß√£o
          </button>
          <button
            id="conflict-approve-skip-btn"
            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors text-sm order-2 sm:order-2"
          >
            Aprovar Somente Vagos
          </button>
          <button
            id="conflict-approve-force-btn"
            class="bg-yellow-600 hover:bg-yellow-700 text-black font-bold py-2 px-4 rounded transition-colors text-sm order-1 sm:order-3"
          >
            Substituir Conflitos
          </button>
        </div>
      </div>
    </div>

    
    <!-- Script JS Externo -->
    <script src="script.js" defer></script>
  </body>
</html>
